name: Puzzle 135 Hunter
on: workflow_dispatch
jobs:
  hunt:
    runs-on: windows-latest
    timeout-minutes: 240
    steps:
      - name: Download previous progress
        uses: actions/download-artifact@v4
        continue-on-error: true
        with:
          name: p135-checkpoint
          path: C:\Kangaroo

      - name: Start Tailscale
        uses: tailscale/github-action@v3
        with:
          authkey: ${{ secrets.TAILSCALE_AUTH_KEY }}

      - name: Enable RDP + Set User Password
        run: |
          Set-ItemProperty 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name fDenyTSConnections -Value 0 -Force
          Set-ItemProperty 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name UserAuthentication -Value 0 -Force
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          $pass = -join ((65..90)+(97..122)+(48..57) | Get-Random -Count 16 | % {[char]$_})
          Set-LocalUser -Name "runneradmin" -Password (ConvertTo-SecureString $pass -AsPlainText -Force)
          echo "PASS=$pass" >> $env:GITHUB_ENV

      - name: Build and Launch Kangaroo 256-bit for Puzzle 135
        run: |
          mkdir C:\Kangaroo
          cd C:\Kangaroo
          git clone https://github.com/mikorist/Kangaroo-256-bit .
          # Open the solution and build Release x64 using MSBuild (pre-installed on runners)
          & "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\MSBuild\Current\Bin\MSBuild.exe" "VC_CUDA102\Kangaroo.sln" /p:Configuration=Release /p:Platform=x64 /maxcpucount
          # Create input file with range and compressed pubkey
          @"
          4000000000000000000000000000000000000000000000000000000000000000
          7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
          02145d2611c823a396ef6712ce0f712f09b9b4f3135e3e0aa3230fb9b6d08d1e16
          "@ > in.txt
          # Run CPU mode (no CUDA/GPU on GitHub runners)
          .\Release\kangaroo-256.exe -t 8 -d 20 -w p135.save -wi 60 -ws in.txt

      - name: Save progress for next run
        uses: actions/upload-artifact@v4
        with:
          name: p135-checkpoint
          path: C:\Kangaroo\p135.save*

      - name: Show connection info + keep alive
        run: |
          $ip = tailscale ip -4
          Write-Host "=========================================="
          Write-Host "RDP READY â€“ Connect now!"
          Write-Host "Tailscale IP : $ip"
          Write-Host "Username : runneradmin"
          Write-Host "Password : $env:PASS"
          Write-Host "Puzzle 135 Kangaroo (256-bit fork) running on CPU"
          Write-Host "Progress resumes via artifacts"
          Write-Host "=========================================="
          Add-Type -AssemblyName System.Windows.Forms
          while ($true) {
            [System.Windows.Forms.Cursor]::Position = New-Object System.Drawing.Point((Get-Random -Maximum 1920),(Get-Random -Maximum 1080))
            Start-Sleep -Seconds 300
          }
