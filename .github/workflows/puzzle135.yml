name: Puzzle 135 Hunter RDP
on: workflow_dispatch
jobs:
  hunt:
    runs-on: windows-latest
    timeout-minutes: 240
    steps:
      - name: Download previous progress
        uses: actions/download-artifact@v4
        continue-on-error: true
        with:
          name: p135-checkpoint
          path: C:\Kangaroo

      - name: Start Tailscale
        uses: tailscale/github-action@v3
        with:
          authkey: ${{ secrets.TAILSCALE_AUTH_KEY }}

      - name: Enable RDP + Create User
        run: |
         - name: Enable RDP + Create User
  run: |
    Set-ItemProperty 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name fDenyTSConnections -Value 0 -Force
    Set-ItemProperty 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name UserAuthentication -Value 0 -Force
    netsh advfirewall firewall add rule name=RDP dir=in action=allow protocol=TCP localport=3389

    $pass = -join ((65..90)+(97..122)+(48..57) | Get-Random -Count 16 | % {[char]$_})
    net user rdp $pass /add /active:yes

    # Wait for user to propagate
    Start-Sleep -Seconds 10

    # Use PowerShell cmdlets (better in Actions)
    Add-LocalGroupMember -Group "Administrators" -Member "rdp"
    Add-LocalGroupMember -Group "Remote Desktop Users" -Member "rdp"

    echo "PASS=$pass" >> $env:GITHUB_ENV
    
      - name: Launch Kangaroo for Puzzle 135
        run: |
          iwr "https://github.com/JeanLucPons/Kangaroo/releases/download/v2.2/Kangaroo_v2.2_win64.zip" -OutFile k.zip
          Expand-Archive k.zip -DestinationPath C:\Kangaroo
          cd C:\Kangaroo
          .\Kangaroo.exe -gpu -gpuId auto -d 24 -m 80000000 -w p135.save -wi 30 -ws -r 4000000000000000000000000000000000000000000000000000000000000000:7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff -p 02145d2611c823a396ef6712ce0f712f09b9b4f3135e3e0aa3230fb9b6d08d1e16

      - name: Save progress
        uses: actions/upload-artifact@v4
        with:
          name: p135-checkpoint
          path: C:\Kangaroo\p135.save*

      - name: Connection info + keep alive
        run: |
          $ip = tailscale ip -4
          Write-Host "RDP via Tailscale IP: $ip | User: rdp | Pass: $env:PASS"
          Add-Type -AssemblyName System.Windows.Forms
          while ($true) { [System.Windows.Forms.Cursor]::Position = New-Object System.Drawing.Point((Get-Random -Max 1920),(Get-Random -Max 1080)); Start-Sleep -Seconds 300 }
